<!DOCTYPE html>
<html>
	<head>
		<title>BrainScript Compiler</title>
		<script>
_ = 1; __ = 2; ___ = 3; ____ = 4; _____ = 5; ______ = 6; _______ = 7;		
		
function intToUnderscores(i) {
	if (i == 0) 		return '(_-_)';
	else if (i < 3)		return Array(i + 1).join('_');
	else if (i == 3)	return '__+_';
	
	var c 	= (Math.abs((2 << Math.floor(Math.log(i)/Math.log(2) - 1)) - i) <= Math.abs(((2 << Math.floor(Math.log(i)/Math.log(2) - 1)) * 2) - i)) ? 1 : 0;
	var str = '__<<' + intToUnderscores(Math.floor(Math.log(i)/Math.log(2) - c)), num = eval(str);
	
	return '(' + str + ')' + (((i - num) == 0) ? '' : ((c == 1) ? '+' : '-') + '(' + intToUnderscores(Math.abs(i - num)) + ')');
}

function convert(str){
	var i, r = '', s = '';
	for (i=0; i<str.length; i++){
		if (i % 1000 === 0){
			s += r + (s ? ';' : '') + '$$$+=';
			r = '';
		}
		if (r){
			r += '+';
		}
		r += '$(';
		r += intToUnderscores(str.charCodeAt(i));
		r += ')';
	}
	s += r + '+([]+[]);';
	return s;
}

function $$$$$(){
	var	source	= document.getElementById('s').value,
		result	= document.getElementById('r'),
		nowrap	= document.getElementById('x'),
		r	= convert(source);
	result.value	=
		'_=+!!{};__=_<<_;$=[![]]+[!![]]+{}+(_/(+!{}))+({})[{}];$_=[][$$=$[__+_]+$[(__<<__)+__]+$[(__<<__)-__]+$[(__<<_)+_]];$_$=$_();$$$=$[(__<<__<<_)-__]+$[(__<<__)+__]+$[(__<<__<<__)-(__<<_)]+$[__+_]+$[(__<<_)+_]+$[(__<<__)-__]+$[(__<<__)-_]+$[(__<<__<<_)-__]+$[(__<<_)+_]+$[(__<<__)+__]+$[(__<<__)-__];__$=[]+(+!{})[$$$];$+=__$[(__<<__<<__)+(__<<__)]?__$[(__<<__)+__]+__$[(__<<__)+__*__]:__$[(__<<__)+_]+__$[(__<<__)+_+__];__$=[]+([]+[])[$$$];$+=__$[(__<<__<<__)+(__<<__)]?__$[(__<<__)+__]+__$[(__<<__)+(__<<__)-_]:__$[(__<<__)+_]+__$[(__<<__)+(__<<__)-__];$_=$_$[$[(__<<__<<__)+__]+$[(__<<__)+__]+$[(__<<__<<_)-__]+$[(__<<__)-_]+$[(__<<__<<__)+(__<<__)+__]+$[__<<_]+$[(__<<__<<__)-(__<<_)]+$[(__<<_)+_]];$__=[]+$_[$[_]+$[__]+$[__]];$+=$__[(__<<__)+__+_]+$__[__<<__]+($__[(__<<__<<_)+(__<<__)+_]?$__[(__<<__<<_)-_]:$__[(__<<__)+__*__]);$+=([]+$_$)[(__<<__<<_)-_]===$[(__<<__)+__]?([]+$_$)[__<<__<<_]:([]+$_$)[(__<<__<<_)-__-_];$+=$[(__<<__<<__)+(__<<__<<_)-__][$[(__<<_)+_]+$[(__<<__)+__]+$[(__<<__<<__)+(__<<__<<_)-_-__]+$[(__<<__)+__]+$[(__<<__<<__)+(__<<__)*__]+$[__<<_]+$[(__<<__)-__]+$[(__<<__<<__)+(__<<__<<_)-_]+$[_]+$[__+_]+$[__<<_]]();$=$[$$$][$[_-_]+$[(__<<__)-__]+$[(__<<__)+__]+$[(__<<__<<__)+(__<<__)+__]+$[(__<<__<<__)+(__<<__<<_)-_]+$[(__<<__<<__)+(__<<__<<_)+_]+$[_]+$[(__<<__)-__]+$[(__<<__<<__)+(__<<__<<_)-_]+$[(__<<__)+__]+$[(__<<__<<__)+__]+$[__<<_]];$_$=$_$[($(((_<<_<<_<<_<<_<<_<<_)+(_<<_<<_<<_<<_<<_)+(_<<_<<_)+(_)))+$(((_<<_<<_<<_<<_<<_<<_)+(_<<_<<_<<_<<_<<_)+(_<<_<<_<<_<<_)+(_<<_<<_)+(_<<_)))+$(((_<<_<<_<<_<<_<<_<<_)+(_<<_<<_<<_<<_<<_)+(_)))+$(((_<<_<<_<<_<<_<<_<<_)+(_<<_<<_<<_<<_<<_)+(_<<_<<_<<_)+(_<<_<<_))))];$$$=[]+[];' +
		r +
		'$_$($$$, $_=$__=__$=$$$=$=_=__=({})[$]),$_$=({})[$_$];';
	nowrap.value = r;
}
		</script>
	</head>
	<body>
		<label for=s>JavaScript source:</label><br/>
		<textarea id=s></textarea><br/>
		<button onclick="$$$$$()">Compile</button><br/>
		<label for=r>BrainScript result:</label><br/>
		<textarea id=r></textarea><br/>
		<label for=x>Result without wrapper:</label><br/>
		<textarea id=x></textarea><br/>
	</body>
</html>
