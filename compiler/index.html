<!DOCTYPE html>
<html>
	<head>
		<title>BrainScript Compiler</title>
		<script>
function intToUnderscores(i){
	var str = '', mask = 128, ch;
	if (!i){
		return '(_-_)';
	}
	while (i){
		ch = i >= mask ? mask : 0;
		i -= ch;
		if (ch){
			str += (str ? '+' : '') + '(_';
			while (ch > 1){
				ch /= 2;
				str += '<<_';
			}
			str += ')';
		}
		mask /= 2;
	}
	return '(' + str + ')';
}

function convert(str){
	var i, r = '', s = '';
	for (i=0; i<str.length; i++){
		if (i % 1000 === 0){
			s += r + (s ? ';' : '') + '$$$+=';
			r = '';
		}
		if (r){
			r += '+';
		}
		r += '$(';
		r += intToUnderscores(str.charCodeAt(i));
		r += ')';
	}
	s += r + '+([]+[]);';
	return s;
}

function $$$$$(){
	var	source	= document.getElementById('s').value,
		result	= document.getElementById('r'),
		nowrap	= document.getElementById('x'),
		r	= convert(source);
	result.value	=
		'_=+!!{};__=_<<_;$=[![]]+[!![]]+{}+(_/(+!{}))+({})[{}];$_=[][$$=$[__+_]+$[(__<<__)+__]+$[(__<<__)-__]+$[(__<<_)+_]];$_$=$_();$$$=$[(__<<__<<_)-__]+$[(__<<__)+__]+$[(__<<__<<__)-(__<<_)]+$[__+_]+$[(__<<_)+_]+$[(__<<__)-__]+$[(__<<__)-_]+$[(__<<__<<_)-__]+$[(__<<_)+_]+$[(__<<__)+__]+$[(__<<__)-__];__$=[]+(+!{})[$$$];$+=__$[(__<<__)+_]+__$[(__<<__)+_+__];__$=[]+([]+[])[$$$];$+=__$[(__<<__)+_]+__$[(__<<__)+(__<<__)-__];$_=$_$[$[(__<<__<<__)+__]+$[(__<<__)+__]+$[(__<<__<<_)-__]+$[(__<<__)-_]+$[(__<<__<<__)+(__<<__)+__]+$[__<<_]+$[(__<<__<<__)-(__<<_)]+$[(__<<_)+_]];$__=[]+$_[$[_]+$[__]+$[__]];$+=$__[(__<<__)+__+_]+$__[__<<__]+($__[(__<<__<<_)+(__<<__)+_]?$__[(__<<__<<_)-_]:$__[(__<<__)+__*__]);$+=([]+$_$)[(__<<__<<_)-_]===$[(__<<__)+__]?([]+$_$)[__<<__<<_]:([]+$_$)[(__<<__<<_)-__-_];$+=$[(__<<__<<__)+(__<<__<<_)-__][$[(__<<_)+_]+$[(__<<__)+__]+$[(__<<__<<__)+(__<<__<<_)-_-__]+$[(__<<__)+__]+$[(__<<__<<__)+(__<<__)*__]+$[__<<_]+$[(__<<__)-__]+$[(__<<__<<__)+(__<<__<<_)-_]+$[_]+$[__+_]+$[__<<_]]();$=$[$$$][$[_-_]+$[(__<<__)-__]+$[(__<<__)+__]+$[(__<<__<<__)+(__<<__)+__]+$[(__<<__<<__)+(__<<__<<_)-_]+$[(__<<__<<__)+(__<<__<<_)+_]+$[_]+$[(__<<__)-__]+$[(__<<__<<__)+(__<<__<<_)-_]+$[(__<<__)+__]+$[(__<<__<<__)+__]+$[__<<_]];$_$=$_$[($(((_<<_<<_<<_<<_<<_<<_)+(_<<_<<_<<_<<_<<_)+(_<<_<<_)+(_)))+$(((_<<_<<_<<_<<_<<_<<_)+(_<<_<<_<<_<<_<<_)+(_<<_<<_<<_<<_)+(_<<_<<_)+(_<<_)))+$(((_<<_<<_<<_<<_<<_<<_)+(_<<_<<_<<_<<_<<_)+(_)))+$(((_<<_<<_<<_<<_<<_<<_)+(_<<_<<_<<_<<_<<_)+(_<<_<<_<<_)+(_<<_<<_))))];$$$=[]+[];' +
		r +
		'$_$($$$, $_=$__=__$=$$$=$=_=__=({})[$]),$_$=({})[$_$];';
	nowrap.value = r;
}
		</script>
	</head>
	<body>
		<label for=s>JavaScript source:</label><br/>
		<textarea id=s></textarea><br/>
		<button onclick="$$$$$()">Compile</button><br/>
		<label for=r>BrainScript result:</label><br/>
		<textarea id=r></textarea><br/>
		<label for=x>Result without wrapper:</label><br/>
		<textarea id=x></textarea><br/>
	</body>
</html>
